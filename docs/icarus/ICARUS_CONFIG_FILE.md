# Icarus config file (`icarus.cfg`)

The `icarus.cfg` file defines package metadata and build configuration for Icarus Builder.
Builder commands read this file to determine:

- Package identity and version
- `build-system` selection
- Python versions and default runtime
- Dependency requirement files
- Project ignore patterns

## Where it lives

`icarus.cfg` must live at the package root.

Icarus searches upward from the current working directory until it finds `icarus.cfg`.

## Format rules

- File format is YAML.
- Use spaces for indentation.
- Keep the key structure shown in the examples below.
- Comments start with `#`.
- Use ASCII text for maximum compatibility.

## Full example (all supported options)

```yaml
# icarus.cfg

package:
  - name: ProjectNameHere
  - language: ProjectLanguageHere
  # Version must follow Semantic Versioning (SemVer): MAJOR.MINOR.PATCH
  # See https://semver.org
  - version: 1.0.0

build-system:
  # The build-system directive specifies the executable used to build the package.
  # You must make sure that the build-system build package is listed in tool-dependencies.
  - system: icarus-python3
  - build-root: build

icarus-python3:
  - python:
    - '3.13'
    - '3.12'
  - python-default: '3.13'
  # Lists dependencies that are required at build time for the package.
  - tool-dependencies:
    - 'requirements/tool-requirements.txt'
  # Lists "library" (AKA "direct") dependencies for your package.
  - run-dependencies:
    - 'requirements/run-requirements.txt'
  # Lists dependencies that are required at development time for the package.
  - dev-dependencies:
    - 'requirements/dev-requirements.txt'
  - read-the-docs:
    # The output file generated by Icarus Builder with the requirements to
    # build your documentation.
    - requirements: 'requirements/read-the-docs-requirements.txt'

icarus-cdk:
  - pass: 'Not Implemented Yet'

ignore:
  - '.icarus/'
  - '.git/'
  - '.github/'
  - '.idea/'
  - '**/.mypy_cache/'
  - '**/.pytest_cache/'
  - '**/__pycache__/'
  - '**/*.egg-info/'
  - 'build/'
  - 'dist/'
```

## Top-level directives

| Directive | Required | Description |
| --- | --- | --- |
| `package` | Yes | Package metadata (`name`, `language`, `version`). |
| `build-system` | Yes | `build-system` selection and build root directory. |
| `icarus-python3` | Yes (when `system: icarus-python3`) | Python versions and dependency files used by builder flows. |
| `icarus-cdk` | Yes (when `system: icarus-cdk`) | Reserved placeholder; currently not supported. |
| `ignore` | No | Glob-like patterns to exclude from builder scanning/operations. |

## Directive details

### `package`

The `package` directive defines two concepts: package identity and package version.

Identity (`name`, `language`):

- `name` and `language` are generated by `icarus builder create`.
- They are consumed by multiple Icarus flows (build, path, release, docs), parser/handler logic,
  and generated metadata artifacts.
- Manual edits after project creation are discouraged.

Version (`version`):

The package version identifies a specific release of your package. In Icarus, that version
represents the package source state and dependency set used to produce build artifacts across
the configured platforms/runtimes.

Use Semantic Versioning to communicate change scope:

- `MAJOR`: incompatible or breaking changes
- `MINOR`: backward-compatible feature additions
- `PATCH`: backward-compatible fixes and small maintenance changes

Expected shape:

```yaml
package:
  - name: MyPackage
  - language: Python3
  - version: 2.8.2
```

Rules:

- `name`: required, string
- `language`: required, string
- `version`: required, string, expected format `MAJOR.MINOR.PATCH`

### `build-system`

The `build-system` directive selects the package build toolchain. Icarus Builder performs
the common setup (argument parsing, path/layout resolution, environment orchestration)
and then hands execution to the selected build system.

In other words, Icarus Builder is the orchestrator, while `build-system` defines the
tool-specific implementation of how the package is built.

Expected shape:

```yaml
build-system:
  - system: icarus-python3
  - build-root: build
```

Rules:

- `system`: required, string
- `build-root`: required, string
- Use the directive name exactly as `build-system`
- `system` maps to a top-level build-system block (for example, `icarus-python3` -> `icarus-python3:`)
- Supported `build-system.system` value today: `icarus-python3`
- `icarus-cdk` is parsed as a known enum value but currently raises a "not yet supported" error when used.

### `icarus-python3`

This block configures Python runtimes and dependency inputs used by builder flows when
`build-system.system` is `icarus-python3`.

Expected shape:

```yaml
icarus-python3:
  - python:
    - '3.13'
    - '3.12.9'
  - python-default: '3.13'
  - tool-dependencies:
    - 'requirements/tool-requirements.txt'
  - run-dependencies:
    - 'requirements/run-requirements.txt'
  - dev-dependencies:
    - 'requirements/dev-requirements.txt'
  - read-the-docs:
    - requirements: 'requirements/read-the-docs-requirements.txt'
```

Rules:

- `python`: required list of strings
  - each item must look like `X.Y` or `X.Y.Z`
  - this list defines which Python versions Icarus can build and resolve for runtime farms
- `python-default`: required string
  - must be present in the `python` list
  - defines the default Python used for default-only operations and default path resolution
- `tool-dependencies`: optional list of requirement file paths
  - build-time tools installed into `tool.runtimefarm` (formatters, linters, packaging tools)
- `run-dependencies`: optional list of requirement file paths
  - legacy runtime requirements files kept for compatibility
  - preferred runtime dependency source is `pyproject.toml` under `project.dependencies`
- `dev-dependencies`: optional list of requirement file paths
  - additional requirements installed for development farms (`devrun*`)
- `read-the-docs`: optional
  - if provided, `requirements` must be a string path
  - this is the output file generated by `icarus builder hook --readthedocs`

Notes:

- Icarus may normalize and reorder versions internally.
- Duplicate items in dependency path lists are de-duplicated internally.

### `icarus-cdk`

Current status:

- Reserved for future support.
- Do not set `build-system.system` to `icarus-cdk` yet.

### `ignore`

Expected shape:

```yaml
ignore:
  - '.git/'
  - '.idea/'
  - '**/__pycache__/'
  - 'build/'
```

Rules:

- Optional list of strings
- Avoid invalid patterns containing `//` or `***` (these are rejected)

## Best practices

- Keep `version` synchronized with your package release process.
- Keep dependency file paths relative to project root.
- Keep `ignore` small and intentional.
- Prefer stable Python major/minor in `python-default`.
- Validate changes by running a builder command after edits.
