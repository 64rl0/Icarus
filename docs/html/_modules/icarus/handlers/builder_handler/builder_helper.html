

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>icarus.handlers.builder_handler.builder_helper &mdash; Icarus r. documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=9edc463e" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=30015795"></script>
      <script src="../../../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Icarus
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../_apidoc/modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Icarus</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">icarus.handlers.builder_handler.builder_helper</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for icarus.handlers.builder_handler.builder_helper</h1><div class="highlight"><pre>
<span></span><span class="c1"># ======================================================================</span>
<span class="c1"># MODULE DETAILS</span>
<span class="c1"># This section provides metadata about the module, including its</span>
<span class="c1"># creation date, author, copyright information, and a brief description</span>
<span class="c1"># of the module&#39;s purpose and functionality.</span>
<span class="c1"># ======================================================================</span>

<span class="c1">#   __|    \    _ \  |      _ \   __| __ __| __ __|</span>
<span class="c1">#  (      _ \     /  |     (   | (_ |    |      |</span>
<span class="c1"># \___| _/  _\ _|_\ ____| \___/ \___|   _|     _|</span>

<span class="c1"># src/icarus/handlers/builder_handler/builder_helper.py</span>
<span class="c1"># Created 5/24/25 - 8:48 PM UK Time (London) by carlogtt</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module ...</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># ======================================================================</span>
<span class="c1"># EXCEPTIONS</span>
<span class="c1"># This section documents any exceptions made code or quality rules.</span>
<span class="c1"># These exceptions may be necessary due to specific coding requirements</span>
<span class="c1"># or to bypass false positives.</span>
<span class="c1"># ======================================================================</span>
<span class="c1">#</span>

<span class="c1"># ======================================================================</span>
<span class="c1"># IMPORTS</span>
<span class="c1"># Importing required libraries and modules for the application.</span>
<span class="c1"># ======================================================================</span>

<span class="c1"># Standard Library Imports</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">errno</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">fcntl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">getpass</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tomllib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">IO</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="c1"># Third Party Library Imports</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>

<span class="c1"># My Library Imports</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">carlogtt_python_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mylib</span>

<span class="c1"># Local Application Imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">icarus</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span><span class="p">,</span> <span class="n">utils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">icarus.handlers.builder_handler.model</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BuildSystems</span><span class="p">,</span>
    <span class="n">IcarusBuilderArg</span><span class="p">,</span>
    <span class="n">IcarusBuilderCliArg</span><span class="p">,</span>
    <span class="n">IcarusBuilderOperation</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># END IMPORTS</span>
<span class="c1"># ======================================================================</span>


<span class="c1"># List of public names in the module</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;ensure_builder_control_plane&#39;</span><span class="p">,</span>
    <span class="s1">&#39;acquire_builder_lock&#39;</span><span class="p">,</span>
    <span class="s1">&#39;release_builder_lock&#39;</span><span class="p">,</span>
    <span class="s1">&#39;run_bash_script_with_logging&#39;</span><span class="p">,</span>
    <span class="s1">&#39;parse_icarus_builder_cli_arg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_ib_arg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_ib_argv&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Setting up logger for current module</span>
<span class="n">module_logger</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">master_logger</span><span class="o">.</span><span class="n">get_child_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="ensure_builder_control_plane">
<a class="viewcode-back" href="../../../../_apidoc/icarus.handlers.builder_handler.builder_helper.html#icarus.handlers.builder_handler.builder_helper.ensure_builder_control_plane">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ensure_builder_control_plane</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure the builder control plane directories exist in the project.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">project_root_dir_abs</span> <span class="o">=</span> <span class="n">_find_project_root_dir</span><span class="p">()</span>

    <span class="n">control_plane_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">project_root_dir_abs</span><span class="p">)</span> <span class="o">/</span> <span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CONTROL_PLANE_DIRNAME</span>
    <span class="n">log_dir</span> <span class="o">=</span> <span class="n">control_plane_dir</span> <span class="o">/</span> <span class="n">config</span><span class="o">.</span><span class="n">ICARUS_LOG_DIRNAME</span>
    <span class="n">lock_dir</span> <span class="o">=</span> <span class="n">control_plane_dir</span> <span class="o">/</span> <span class="n">config</span><span class="o">.</span><span class="n">ICARUS_LOCK_DIRNAME</span>

    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">(</span><span class="n">control_plane_dir</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">,</span> <span class="n">lock_dir</span><span class="p">):</span>
        <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="acquire_builder_lock">
<a class="viewcode-back" href="../../../../_apidoc/icarus.handlers.builder_handler.builder_helper.html#icarus.handlers.builder_handler.builder_helper.acquire_builder_lock">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">acquire_builder_lock</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">IO</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acquire an exclusive builder lock for the project.</span>

<span class="sd">    :return: A handle for the acquired lock.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lock_path</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">_find_project_root_dir</span><span class="p">())</span>
        <span class="o">/</span> <span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CONTROL_PLANE_DIRNAME</span>
        <span class="o">/</span> <span class="n">config</span><span class="o">.</span><span class="n">ICARUS_LOCK_DIRNAME</span>
        <span class="o">/</span> <span class="n">config</span><span class="o">.</span><span class="n">ICARUS_BUILDER_LOCK_FILENAME</span>
    <span class="p">)</span>

    <span class="n">lock_handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">lock_path</span><span class="p">,</span> <span class="s1">&#39;a+&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">lock_handle</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span> <span class="o">|</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_NB</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">lock_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ex</span><span class="o">.</span><span class="n">errno</span> <span class="ow">in</span> <span class="p">{</span><span class="n">errno</span><span class="o">.</span><span class="n">EACCES</span><span class="p">,</span> <span class="n">errno</span><span class="o">.</span><span class="n">EAGAIN</span><span class="p">,</span> <span class="n">errno</span><span class="o">.</span><span class="n">EWOULDBLOCK</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Icarus builder is already running. Lock file: </span><span class="si">{</span><span class="n">lock_path</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>
        <span class="k">raise</span>

    <span class="n">lock_content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
        <span class="s2">&quot;pid&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span>
        <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
        <span class="s2">&quot;started&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S %Z&#39;</span><span class="p">),</span>
    <span class="p">})</span>

    <span class="n">lock_handle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">lock_handle</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>
    <span class="n">lock_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lock_content</span><span class="p">)</span>
    <span class="n">lock_handle</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">lock_handle</span></div>



<div class="viewcode-block" id="release_builder_lock">
<a class="viewcode-back" href="../../../../_apidoc/icarus.handlers.builder_handler.builder_helper.html#icarus.handlers.builder_handler.builder_helper.release_builder_lock">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">release_builder_lock</span><span class="p">(</span><span class="n">lock_handle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IO</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Release the builder lock and remove the lock file.</span>

<span class="sd">    :param lock_handle: A handle for the lock to be released.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">lock_handle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">lock_handle</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_UN</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">lock_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="run_bash_script_with_logging">
<a class="viewcode-back" href="../../../../_apidoc/icarus.handlers.builder_handler.builder_helper.html#icarus.handlers.builder_handler.builder_helper.run_bash_script_with_logging">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">run_bash_script_with_logging</span><span class="p">(</span>
    <span class="n">script_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span>
    <span class="n">script_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run a Bash script, log trace, and persist error logs on failure.</span>

<span class="sd">    :param script_path:</span>
<span class="sd">    :param script_args:</span>
<span class="sd">    :return: Exit code of the Bash script.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">log_dir</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">_find_project_root_dir</span><span class="p">())</span>
        <span class="o">/</span> <span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CONTROL_PLANE_DIRNAME</span>
        <span class="o">/</span> <span class="n">config</span><span class="o">.</span><span class="n">ICARUS_LOG_DIRNAME</span>
    <span class="p">)</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">start_time_iso</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">SYSTEM_TZ</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">run_log_path</span> <span class="o">=</span> <span class="n">log_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s2">.log&quot;</span>
    <span class="n">trace_log_path</span> <span class="o">=</span> <span class="n">log_dir</span> <span class="o">/</span> <span class="n">config</span><span class="o">.</span><span class="n">ICARUS_TRACE_LOG_FILENAME</span>

    <span class="n">return_code</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">run_bash_script</span><span class="p">(</span>
        <span class="n">script_path</span><span class="o">=</span><span class="n">script_path</span><span class="p">,</span> <span class="n">script_args</span><span class="o">=</span><span class="n">script_args</span><span class="p">,</span> <span class="n">log_path</span><span class="o">=</span><span class="n">run_log_path</span>
    <span class="p">)</span>

    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">end_time_iso</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">end_time</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">SYSTEM_TZ</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">duration_seconds</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">trace_log</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;cwd&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
        <span class="s1">&#39;command&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">script_path</span><span class="p">),</span>
        <span class="s1">&#39;command_args&#39;</span><span class="p">:</span> <span class="n">script_args</span><span class="p">,</span>
        <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="n">run_id</span><span class="p">,</span>
        <span class="s1">&#39;return_code&#39;</span><span class="p">:</span> <span class="n">return_code</span><span class="p">,</span>
        <span class="s1">&#39;start_time&#39;</span><span class="p">:</span> <span class="n">start_time_iso</span><span class="p">,</span>
        <span class="s1">&#39;end_time&#39;</span><span class="p">:</span> <span class="n">end_time_iso</span><span class="p">,</span>
        <span class="s1">&#39;duration_seconds&#39;</span><span class="p">:</span> <span class="n">duration_seconds</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">trace_log_path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">trace_log_handle</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">trace_log</span><span class="p">,</span> <span class="n">trace_log_handle</span><span class="p">)</span>
        <span class="n">trace_log_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Keep the log file if the command was successful</span>
    <span class="k">if</span> <span class="n">return_code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">run_log_path</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">return_code</span></div>



<div class="viewcode-block" id="parse_icarus_builder_cli_arg">
<a class="viewcode-back" href="../../../../_apidoc/icarus.handlers.builder_handler.builder_helper.html#icarus.handlers.builder_handler.builder_helper.parse_icarus_builder_cli_arg">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_icarus_builder_cli_arg</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IcarusBuilderCliArg</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the arguments received from the CLI and return the appropriate</span>
<span class="sd">    operation and arguments.</span>

<span class="sd">    :param args: The parsed arguments.</span>
<span class="sd">    :return: The operation and arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ib_cli_arg</span> <span class="o">=</span> <span class="n">IcarusBuilderCliArg</span><span class="p">()</span>

    <span class="n">too_many_args</span> <span class="o">=</span> <span class="s1">&#39;too many arguments&#39;</span>
    <span class="n">args_required</span> <span class="o">=</span> <span class="s1">&#39;the following arguments are required: &lt;subcommand&gt;&#39;</span>
    <span class="n">standalone_arg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{hook}</span><span class="s1"> is a standalone argument and must be used alone&#39;</span>

    <span class="n">base_args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">builder_hooks</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;build&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;release&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;release&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;docs&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;docs&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;clean&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;clean&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;isort&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;isort&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;black&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;flake8&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;flake8&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;mypy&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;mypy&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;shfmt&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;shfmt&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;eolnorm&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;eolnorm&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;whitespaces&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;whitespaces&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;trailing&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;trailing&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;eofnewline&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;eofnewline&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;gitleaks&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;gitleaks&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pytest&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;pytest&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sphinx&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;sphinx&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;readthedocs&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;readthedocs&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pypi&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;pypi&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;merge&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;merge&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;exectool&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;exec-tool&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;exec_tool&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;execrun&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;exec-run&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;exec_run&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;execdev&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;exec-dev&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;exec_dev&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;bumpver&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;bumpver&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">builder_hooks_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">builder_hooks</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">el</span><span class="p">)</span>

    <span class="n">cache_hooks</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;cache_root&#39;</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">args</span><span class="o">.</span><span class="n">cache_subcommands</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;cache_subcommands&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;cache-root&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;cache_clean&#39;</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">args</span><span class="o">.</span><span class="n">cache_subcommands</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;cache_subcommands&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;clean&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="p">),</span>
    <span class="p">}</span>

    <span class="n">cache_hooks_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">cache_hooks</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">el</span><span class="p">)</span>

    <span class="n">path_hooks</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;list_paths&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="s1">&#39;path_name&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;path_name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">path_hooks_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">path_hooks</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">el</span><span class="p">)</span>

    <span class="n">builder_subcommand</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;build-runtime&#39;</span><span class="p">,</span>
        <span class="s1">&#39;create&#39;</span><span class="p">,</span>
        <span class="s1">&#39;path&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cache&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">builder_command</span> <span class="ow">in</span> <span class="n">builder_subcommand</span> <span class="ow">and</span> <span class="n">builder_hooks_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="n">too_many_args</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">builder_command</span> <span class="o">==</span> <span class="s1">&#39;build-runtime&#39;</span><span class="p">:</span>
        <span class="n">ib_cli_arg</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">IcarusBuilderOperation</span><span class="o">.</span><span class="n">BUILD_RUNTIME</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">builder_command</span> <span class="o">==</span> <span class="s1">&#39;create&#39;</span><span class="p">:</span>
        <span class="n">ib_cli_arg</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">IcarusBuilderOperation</span><span class="o">.</span><span class="n">CREATE</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">builder_command</span> <span class="o">==</span> <span class="s1">&#39;cache&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cache_hooks_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="n">args_required</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cache_hooks_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="n">too_many_args</span><span class="p">)</span>

        <span class="n">ib_cli_arg</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">IcarusBuilderOperation</span><span class="o">.</span><span class="n">CACHE</span>
        <span class="n">ib_cli_arg</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">base_args</span><span class="p">,</span> <span class="o">**</span><span class="n">builder_hooks</span><span class="p">,</span> <span class="o">**</span><span class="n">cache_hooks</span><span class="p">}</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">builder_command</span> <span class="o">==</span> <span class="s1">&#39;path&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">path_hooks_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="n">args_required</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">path_hooks_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="n">too_many_args</span><span class="p">)</span>

        <span class="n">ib_cli_arg</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">IcarusBuilderOperation</span><span class="o">.</span><span class="n">PATH</span>
        <span class="n">ib_cli_arg</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">base_args</span><span class="p">,</span> <span class="o">**</span><span class="n">builder_hooks</span><span class="p">,</span> <span class="o">**</span><span class="n">path_hooks</span><span class="p">}</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">builder_command</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">builder_subcommand</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">builder_hooks_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="n">args_required</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">builder_hooks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;clean&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">builder_hooks_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="n">standalone_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hook</span><span class="o">=</span><span class="s1">&#39;--clean&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">builder_hooks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;merge&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">builder_hooks_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="n">standalone_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hook</span><span class="o">=</span><span class="s1">&#39;--merge&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">builder_hooks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;exectool&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">builder_hooks_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="n">standalone_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hook</span><span class="o">=</span><span class="s1">&#39;--exec-tool&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">builder_hooks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;execrun&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">builder_hooks_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="n">standalone_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hook</span><span class="o">=</span><span class="s1">&#39;--exec-run&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">builder_hooks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;execdev&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">builder_hooks_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="n">standalone_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hook</span><span class="o">=</span><span class="s1">&#39;--exec-dev&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">builder_hooks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bumpver&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">builder_hooks_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="n">standalone_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hook</span><span class="o">=</span><span class="s1">&#39;--bumpver&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">builder_hooks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pypi&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">builder_hooks_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="n">standalone_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hook</span><span class="o">=</span><span class="s1">&#39;--pypi&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">builder_hooks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bumpver&#39;</span><span class="p">):</span>
            <span class="n">ib_cli_arg</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">IcarusBuilderOperation</span><span class="o">.</span><span class="n">BUMPVER</span>
            <span class="n">ib_cli_arg</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">base_args</span><span class="p">,</span> <span class="o">**</span><span class="n">builder_hooks</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ib_cli_arg</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">IcarusBuilderOperation</span><span class="o">.</span><span class="n">BUILDER</span>
            <span class="n">ib_cli_arg</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">base_args</span><span class="p">,</span> <span class="o">**</span><span class="n">builder_hooks</span><span class="p">}</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="n">args_required</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ib_cli_arg</span></div>



<div class="viewcode-block" id="get_ib_arg">
<a class="viewcode-back" href="../../../../_apidoc/icarus.handlers.builder_handler.builder_helper.html#icarus.handlers.builder_handler.builder_helper.get_ib_arg">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_ib_arg</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]])</span> <span class="o">-&gt;</span> <span class="n">IcarusBuilderArg</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the arguments as IcarusBuilderArg object.</span>

<span class="sd">    :param cli_ib_arg: The parsed arguments.</span>
<span class="sd">    :return: The arguments as IcarusBuilderArg object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ib_arg</span> <span class="o">=</span> <span class="n">IcarusBuilderArg</span><span class="p">()</span>

    <span class="n">_read_icarus_build_cfg</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">)</span>
    <span class="n">_parse_icarus_build_cfg</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">)</span>
    <span class="n">_validate_icarus_build_cfg</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">)</span>
    <span class="n">_parse_pyproject_toml</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">)</span>
    <span class="n">_process_cli_ib_args</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">,</span> <span class="n">cli_ib_arg</span><span class="p">)</span>
    <span class="n">_normalize_and_set_defaults_icarus_build_cfg</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">)</span>
    <span class="n">_normalize_and_set_python_version</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ib_arg</span></div>



<div class="viewcode-block" id="get_ib_argv">
<a class="viewcode-back" href="../../../../_apidoc/icarus.handlers.builder_handler.builder_helper.html#icarus.handlers.builder_handler.builder_helper.get_ib_argv">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_ib_argv</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the arguments for the builder.sh script as a string.</span>

<span class="sd">    :param cli_ib_arg:</span>
<span class="sd">    :return: The arguments for the builder.sh script.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ib_arg</span> <span class="o">=</span> <span class="n">get_ib_arg</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="o">=</span><span class="n">cli_ib_arg</span><span class="p">)</span>

    <span class="n">ib_argv</span> <span class="o">=</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">as_bash_argv</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ib_argv</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_process_cli_ib_args</span><span class="p">(</span>
    <span class="n">ib_arg</span><span class="p">:</span> <span class="n">IcarusBuilderArg</span><span class="p">,</span> <span class="n">cli_ib_arg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process the arguments received from the CLI and set the</span>
<span class="sd">    appropriate values.</span>

<span class="sd">    :param ib_arg: The IcarusBuilderArg object to be updated.</span>
<span class="sd">    :param cli_ib_arg: The parsed arguments.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">cli_ib_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">):</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>

    <span class="k">if</span> <span class="n">cli_ib_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;exectool&#39;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;exectool&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;exectool&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">initial_exectool_command_received</span> <span class="o">=</span> <span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;exectool&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;exectool&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;exectool&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">initial_exectool_command_received</span> <span class="o">=</span> <span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;exectool&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="s1">&#39;Invalid --exec-tool argument&#39;</span><span class="p">)</span>
        <span class="c1"># altering the exec value so it can be used from the for loop</span>
        <span class="c1"># here below to make up the initial_command_received look pretty</span>
        <span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;exectool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;--exec-tool </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;exectool&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">cli_ib_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;execrun&#39;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execrun&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execrun&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">initial_execrun_command_received</span> <span class="o">=</span> <span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execrun&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execrun&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execrun&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">initial_execrun_command_received</span> <span class="o">=</span> <span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execrun&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="s1">&#39;Invalid --exec-run argument&#39;</span><span class="p">)</span>
        <span class="c1"># altering the exec value so it can be used from the for loop</span>
        <span class="c1"># here below to make up the initial_command_received look pretty</span>
        <span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execrun&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;--exec-run </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execrun&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">cli_ib_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;execdev&#39;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execdev&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execdev&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">initial_execdev_command_received</span> <span class="o">=</span> <span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execdev&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execdev&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execdev&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">initial_execdev_command_received</span> <span class="o">=</span> <span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execdev&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="s1">&#39;Invalid --exec-dev argument&#39;</span><span class="p">)</span>
        <span class="c1"># altering the exec value so it can be used from the for loop</span>
        <span class="c1"># here below to make up the initial_command_received look pretty</span>
        <span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execdev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;--exec-dev </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;execdev&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># HOOKS</span>
    <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">all_hooks</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cli_ib_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hook</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">,</span> <span class="n">hook</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span>

    <span class="c1"># RELEASE target</span>
    <span class="k">if</span> <span class="n">cli_ib_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;release&#39;</span><span class="p">):</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">is_release</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="k">if</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span> <span class="o">==</span> <span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">build</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">isort</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">black</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">flake8</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">mypy</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">shfmt</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">eolnorm</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">whitespaces</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">trailing</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">eofnewline</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">pytest</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">gitleaks</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">sphinx</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="k">elif</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span> <span class="o">==</span> <span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_CDK</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">build</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">shfmt</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">eolnorm</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">whitespaces</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">trailing</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">eofnewline</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">gitleaks</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;The --release target is not configured for the </span><span class="si">{</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span><span class="si">}</span><span class="s1"> build&#39;</span>
                <span class="s1">&#39; systems&#39;</span>
            <span class="p">)</span>

    <span class="c1"># FORMAT target</span>
    <span class="k">if</span> <span class="n">cli_ib_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span> <span class="o">==</span> <span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">isort</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">black</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">shfmt</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">eolnorm</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">whitespaces</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">trailing</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">eofnewline</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="k">elif</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span> <span class="o">==</span> <span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_CDK</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">shfmt</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">eolnorm</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">whitespaces</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">trailing</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">eofnewline</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="s1">&#39;The --format target is not configured for the&#39;</span>
                <span class="sa">f</span><span class="s1">&#39; f</span><span class="si">{</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span><span class="si">}</span><span class="s1"> build systems&#39;</span>
            <span class="p">)</span>

    <span class="c1"># TEST target</span>
    <span class="k">if</span> <span class="n">cli_ib_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span> <span class="o">==</span> <span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">pytest</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="k">elif</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span> <span class="o">==</span> <span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_CDK</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="c1"># This is just a placeholder for now</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">pytest</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;The --test target is not configured for the f</span><span class="si">{</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="s1">&#39; build systems&#39;</span>
            <span class="p">)</span>

    <span class="c1"># DOCS target</span>
    <span class="k">if</span> <span class="n">cli_ib_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;docs&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span> <span class="o">==</span> <span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">sphinx</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="k">elif</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span> <span class="o">==</span> <span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_CDK</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="c1"># This is just a placeholder for now</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">sphinx</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;The --docs target is not configured for the f</span><span class="si">{</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="s1">&#39; build systems&#39;</span>
            <span class="p">)</span>

    <span class="k">for</span> <span class="n">arg_name</span><span class="p">,</span> <span class="n">arg_value</span> <span class="ow">in</span> <span class="n">cli_ib_arg</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">arg_name</span> <span class="o">==</span> <span class="s1">&#39;verbose&#39;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg_value</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">arg_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ib_arg</span><span class="o">.</span><span class="n">initial_command_received</span> <span class="o">+=</span> <span class="s2">&quot; -v&quot;</span>
                <span class="k">continue</span>
        <span class="k">if</span> <span class="n">arg_value</span><span class="p">:</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">initial_command_received</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">arg_value</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Count running hooks</span>
    <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">all_hooks</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">,</span> <span class="n">hook</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">running_hooks_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>

    <span class="n">ib_arg</span><span class="o">.</span><span class="n">running_hooks_count</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">running_hooks_name</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span> <span class="ow">and</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">running_hooks_count</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">is_only_build_hook</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>

    <span class="c1"># Path CLI</span>
    <span class="k">if</span> <span class="n">cli_ib_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path_name&#39;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;path_name&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">path_name</span> <span class="o">=</span> <span class="n">cli_ib_arg</span><span class="p">[</span><span class="s1">&#39;path_name&#39;</span><span class="p">]</span>

    <span class="c1"># Cache CLI</span>
    <span class="k">if</span> <span class="n">cli_ib_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cache_root&#39;</span><span class="p">):</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">cache_root</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
    <span class="k">if</span> <span class="n">cli_ib_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cache_clean&#39;</span><span class="p">):</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">cache_clean</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_read_icarus_build_cfg</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">:</span> <span class="n">IcarusBuilderArg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the icarus build config file.</span>

<span class="sd">    :param ib_arg: The IcarusBuilderArg object to be updated.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">project_root_dir_abs</span> <span class="o">=</span> <span class="n">_find_project_root_dir</span><span class="p">()</span>
    <span class="n">config_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_root_dir_abs</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="p">)</span>

    <span class="n">ib_arg</span><span class="o">.</span><span class="n">icarus_config_filename</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span>
    <span class="n">ib_arg</span><span class="o">.</span><span class="n">icarus_config_filepath</span> <span class="o">=</span> <span class="n">config_filepath</span>
    <span class="n">ib_arg</span><span class="o">.</span><span class="n">project_root_dir_abs</span> <span class="o">=</span> <span class="n">project_root_dir_abs</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_parse_icarus_build_cfg</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">:</span> <span class="n">IcarusBuilderArg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the icarus build config file.</span>

<span class="sd">    :param ib_arg: The IcarusBuilderArg object to be updated.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">icarus_config_filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">icarus_build_config</span><span class="p">:</span>
            <span class="n">ibc</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">icarus_build_config</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error parsing </span><span class="si">{</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">icarus_config_filepath</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">pkg</span> <span class="o">=</span> <span class="n">ibc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;package&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">bs</span> <span class="o">=</span> <span class="n">ibc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;build-system&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">ipy</span> <span class="o">=</span> <span class="n">ibc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">icdk</span> <span class="o">=</span> <span class="n">ibc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_CDK</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">[])</span>  <span class="c1"># noqa</span>
    <span class="n">ignrs</span> <span class="o">=</span> <span class="n">ibc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_name_pascal_case</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">pkg</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_language</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">pkg</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_version_full</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">pkg</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">bs</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_root_dir</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;build-root&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">bs</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;build-root&#39;</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_version_default_for_icarus</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;python-default&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ipy</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;python-default&#39;</span><span class="p">)</span>
        <span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_versions_for_icarus</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;python&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ipy</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;python&#39;</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">tool_requirements_paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;tool-dependencies&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ipy</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tool-dependencies&#39;</span><span class="p">)</span>
        <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">run_requirements_paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;run-dependencies&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ipy</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;run-dependencies&#39;</span><span class="p">)</span>
        <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">dev_requirements_paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;dev-dependencies&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ipy</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dev-dependencies&#39;</span><span class="p">)</span>
        <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">read_the_docs_dict</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;read-the-docs&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ipy</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;read-the-docs&#39;</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">read_the_docs_requirements_path</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;requirements&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">read_the_docs_dict</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;requirements&#39;</span><span class="p">)</span>
        <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">icarus_ignore_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ignrs</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_validate_icarus_build_cfg</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">:</span> <span class="n">IcarusBuilderArg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the icarus build config file.</span>

<span class="sd">    :param ib_arg: The IcarusBuilderArg object to be updated.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_name_pascal_case</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;No name specified in package </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">package_name_pascal_case</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;name in package </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be a string&#39;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_language</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;No language specified in package </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">package_language</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;language in package </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be a string&#39;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_version_full</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;No version specified in package </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">package_version_full</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;version in package </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be a string&#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">package_version_full</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="mi">3</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Invalid version in package </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1">, version must follow&#39;</span>
                <span class="s1">&#39; Semantic Versioning (SemVer): MAJOR.MINOR.PATCH (see https://semver.org).&#39;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;No system specified in build-system </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;system in build-system </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be a string&#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">BuildSystems</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Invalid system in build-system </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_root_dir</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;No build-root specified in build-system </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">build_root_dir</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;build-root in build-system </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be a string&#39;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span> <span class="o">==</span> <span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_versions_for_icarus</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;No python version(s) specified in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">python_versions_for_icarus</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_versions_for_icarus</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;All python version(s) in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be strings&#39;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="ow">in</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_versions_for_icarus</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;All python version(s) in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be valid&#39;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Python version(s) in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be a list of string&#39;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_version_default_for_icarus</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;No python-default version specified in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">python_version_default_for_icarus</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;python-default version in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be a string&#39;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">python_version_default_for_icarus</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span>
                <span class="mi">2</span><span class="p">,</span>
                <span class="mi">3</span><span class="p">,</span>
            <span class="p">}:</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Invalid python-default version in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_version_default_for_icarus</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_versions_for_icarus</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;python-default version in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be in the list of python versions&#39;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">tool_requirements_paths</span><span class="p">:</span>
            <span class="c1"># not a mandatory field</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">tool_requirements_paths</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">tool_requirements_paths</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;All tool-dependencies in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be strings&#39;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">tool_requirements_paths</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;tool-dependencies in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be a list of strings&#39;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">run_requirements_paths</span><span class="p">:</span>
            <span class="c1"># not a mandatory field</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">run_requirements_paths</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">run_requirements_paths</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;All run-dependencies in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be strings&#39;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">run_requirements_paths</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;run-dependencies in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be a list of strings&#39;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">dev_requirements_paths</span><span class="p">:</span>
            <span class="c1"># not a mandatory field</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">dev_requirements_paths</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">dev_requirements_paths</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;All dev-dependencies in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be strings&#39;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">dev_requirements_paths</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;dev-dependencies in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be a list of strings&#39;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">read_the_docs_requirements_path</span><span class="p">:</span>
            <span class="c1"># not a mandatory field</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">read_the_docs_requirements_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;read-the-docs requirements in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be a string&#39;</span>
                <span class="p">)</span>

    <span class="k">if</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span> <span class="o">==</span> <span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_CDK</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;CDK build system not yet supported in </span><span class="si">{</span><span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_CDK</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">icarus_ignore_array</span><span class="p">:</span>
        <span class="c1"># not a mandatory field</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">icarus_ignore_array</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">icarus_ignore_array</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;All icarus ignore in ignore </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be strings&#39;</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">icarus_ignore_array</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;//&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;icarus ignore in ignore </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> cannot contain `//`&#39;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;***&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;icarus ignore in ignore </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> cannot contain `***`&#39;</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Icarus ignore in ignore </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1"> must be a list of string&#39;</span>
            <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_parse_pyproject_toml</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">:</span> <span class="n">IcarusBuilderArg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the pyproject.toml file.</span>

<span class="sd">    :param ib_arg: The IcarusBuilderArg object to be updated.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pyproject_toml_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">project_root_dir_abs</span><span class="p">,</span> <span class="s1">&#39;pyproject.toml&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pyproject_toml_filepath</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pyproject_toml</span><span class="p">:</span>
            <span class="n">pyproject_toml_data</span> <span class="o">=</span> <span class="n">tomllib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pyproject_toml</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># This is an optional requirement we do not raise.</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">run_requirements_pyproject_toml</span> <span class="o">=</span> <span class="n">pyproject_toml_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;project&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;dependencies&#39;</span><span class="p">,</span> <span class="p">[]</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_normalize_and_set_defaults_icarus_build_cfg</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">:</span> <span class="n">IcarusBuilderArg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize the values and set defaults.</span>

<span class="sd">    :param ib_arg: The IcarusBuilderArg object to be updated.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stru</span> <span class="o">=</span> <span class="n">mylib</span><span class="o">.</span><span class="n">StringUtils</span><span class="p">()</span>

    <span class="c1"># Add pkg name snake anf dashed</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_name_snake_case</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">snake_case</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">package_name_pascal_case</span><span class="p">)</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_name_dashed</span> <span class="o">=</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_name_snake_case</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid package name in </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Add pkg version</span>
    <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_version_major</span> <span class="o">=</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_version_full</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_version_minor</span> <span class="o">=</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_version_full</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_version_patch</span> <span class="o">=</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">package_version_full</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Remove duplicates and sort from newest to oldest version</span>
    <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_versions_for_icarus</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">python_versions_for_icarus</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">_sort_version</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">ib_arg</span><span class="o">.</span><span class="n">icarus_ignore_array</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">icarus_ignore_array</span><span class="p">))</span>
    <span class="n">ib_arg</span><span class="o">.</span><span class="n">tool_requirements_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">tool_requirements_paths</span><span class="p">))</span>
    <span class="n">ib_arg</span><span class="o">.</span><span class="n">run_requirements_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">run_requirements_paths</span><span class="p">))</span>
    <span class="n">ib_arg</span><span class="o">.</span><span class="n">dev_requirements_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">dev_requirements_paths</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_normalize_and_set_python_version</span><span class="p">(</span><span class="n">ib_arg</span><span class="p">:</span> <span class="n">IcarusBuilderArg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize the python version.</span>

<span class="sd">    :param ib_arg: The IcarusBuilderArg object to be updated.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">build_system_in_use</span> <span class="o">==</span> <span class="n">BuildSystems</span><span class="o">.</span><span class="n">ICARUS_PYTHON3</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">python_version_default_for_icarus</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_default_version</span> <span class="o">=</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_version_default_for_icarus</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_default_full_version</span> <span class="o">=</span> <span class="n">_get_latest_python_version</span><span class="p">(</span>
                <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_default_version</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">python_version_default_for_icarus</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_default_version</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_version_default_for_icarus</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_default_full_version</span> <span class="o">=</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_version_default_for_icarus</span>

        <span class="n">def_v</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">python_default_version</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">ib_arg</span><span class="o">.</span><span class="n">python_default_full_version</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">tmp_py_v</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_versions_for_icarus</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">short_version</span> <span class="o">=</span> <span class="n">v</span>
                <span class="n">full_version</span> <span class="o">=</span> <span class="n">_get_latest_python_version</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">short_version</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">full_version</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">tmp_py_v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">short_version</span><span class="p">,</span> <span class="n">full_version</span><span class="p">]))</span>

        <span class="c1"># Python default always stays at index 0</span>
        <span class="n">ib_arg</span><span class="o">.</span><span class="n">python_versions</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tmp_py_v</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">def_v</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tmp_py_v</span> <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">def_v</span>
        <span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_find_project_root_dir</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the project root directory containing the icarus config file.</span>

<span class="sd">    :return: Absolute path to the project root directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pwd</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">pwd</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="o">==</span> <span class="n">pwd</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="n">parent</span>

    <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IcarusParserException</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;No `</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1">` file found!</span><span class="se">\n</span><span class="s1">               You are not in an&#39;</span>
        <span class="s1">&#39; icarus builder enabled directory.</span><span class="se">\n</span><span class="s1">               To enable icarus builder create a&#39;</span>
        <span class="sa">f</span><span class="s1">&#39; `</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">ICARUS_CFG_FILENAME</span><span class="si">}</span><span class="s1">` in the project root directory.&#39;</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_latest_python_version</span><span class="p">(</span><span class="n">python_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the latest python full version for the given python version.</span>

<span class="sd">    :param python_version: The python version.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">given_major</span><span class="p">,</span> <span class="n">given_minor</span> <span class="o">=</span> <span class="n">python_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">given_patch</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">reg</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)\.(\d+)\.(\d+)&#39;</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.python.org/ftp/python/&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">reg</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)):</span>
        <span class="n">major</span> <span class="o">=</span> <span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">minor</span> <span class="o">=</span> <span class="n">version</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="n">version</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">major</span> <span class="o">!=</span> <span class="n">given_major</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">minor</span> <span class="o">!=</span> <span class="n">given_minor</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">given_patch</span><span class="p">:</span>
            <span class="n">given_patch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">given_major</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">given_minor</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">given_patch</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_sort_version</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sort version.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">version_split</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">version_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">version_split</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">version_len</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">version_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.0.0&quot;</span>
    <span class="k">elif</span> <span class="n">version_len</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">version_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">version_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">.0&quot;</span>
    <span class="k">elif</span> <span class="n">version_len</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">version_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">version_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">version_split</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">major</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">major</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">major</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;00</span><span class="si">{</span><span class="n">major</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">major</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">major</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;0</span><span class="si">{</span><span class="n">major</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">minor</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">minor</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">minor</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;00</span><span class="si">{</span><span class="n">minor</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">minor</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">minor</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;0</span><span class="si">{</span><span class="n">minor</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">patch</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;00</span><span class="si">{</span><span class="n">patch</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;0</span><span class="si">{</span><span class="n">patch</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">v</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">major</span><span class="si">}{</span><span class="n">minor</span><span class="si">}{</span><span class="n">patch</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">skey</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">skey</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, Carlo Gatti.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>

        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
