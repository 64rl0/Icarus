#!/bin/bash

#   __|    \    _ \  |      _ \   __| __ __| __ __|
#  (      _ \     /  |     (   | (_ |    |      |
# \___| _/  _\ _|_\ ____| \___/ \___|   _|     _|

# bin/icarus
# Created 1/18/25 - 6:35 PM UK Time (London) by carlogtt

# Script Options
set -o errexit  # Exit immediately if a command exits with a non-zero status
set -o pipefail # Exit status of a pipeline is the status of the last cmd to exit with non-zero

declare -r bg_red=$'\033[41m'
declare -r bold_black=$'\033[1;30m'
declare -r end=$'\033[0m'

script_dir_abs="$(realpath -- "$(dirname -- "${BASH_SOURCE[0]}")")"
declare -r script_dir_abs

project_root_dir_abs="$(realpath -- "${script_dir_abs}/..")"
declare -r project_root_dir_abs

os_name="$(uname -s)"
arch_name="$(uname -m)"

case "${os_name}" in
Darwin)
	os_id="macos"
	;;
Linux)
	os_id="linux"
	;;
*)
	echo -e "${bg_red}${bold_black}[ERROR]${end} - Unsupported OS: ${os_name}"
	exit 1
	;;
esac

case "${arch_name}" in
arm64 | aarch64)
	arch_id="arm64"
	;;
x86_64 | amd64)
	arch_id="x86_64"
	;;
*)
	echo -e "${bg_red}${bold_black}[ERROR]${end} - Unsupported architecture: ${arch_name}"
	exit 1
	;;
esac

launcher="${project_root_dir_abs}/launcher/bin/${os_id}/${arch_id}/icarus"

if [[ -x "${launcher}" ]]; then
	exec "${launcher}" "$@"
fi

echo -e "${bg_red}${bold_black}[ERROR]${end} - Missing launcher binary for ${os_id}.${arch_id}"
exit 1
